<project name="BigBlueButton Deploy - Local" default="deploy" basedir=".">

    <property file="default.properties"/>
    <property file="private.properties"/>

    <target name="properties">
        <echoproperties />
    </target>

    <target name="userpass">
        <if>
            <isset property="username"/>
            <then>
                <echo message="username:> ${username}" />
            </then>
            <else>
                <input message="username:> " addproperty="username" />
            </else>
        </if>
        <if>
            <isset property="password"/>
            <then>    
                <echo message="password:> ****" />
            </then>
            <else>
                <input message="password:> " addproperty="password">
                    <handler classname="org.apache.tools.ant.input.SecureInputHandler" />
                </input>
            </else>
        </if>
    </target>

    <target name="deploy">
        <delete dir="${deploy.local.dir}" />
        <mkdir dir="${deploy.local.dir}" />
        <zip destfile="${deploy.local.dir}/bigbluebutton.zip">
            <zipfileset dir="${build.client}" prefix="${name.client}"/>
            <!--<zipfileset dir="${build.apps}" prefix="${name.apps}"/>
            <zipfileset dir="${build.voice}" prefix="${name.voice}"/>
            <zipfileset dir="${build.web}" includes="*.war" prefix="${name.web}"/>-->
        </zip>
        <copy toDir="${deploy.local.dir}">
            <fileset dir="${basedir}">
                <include name="deploy_target.xml" />
                <include name="default.properties" />
                <include name="last_backup" />
            </fileset>
        </copy>
        
        <sshexec host="${target.host}"
                username="${target.username}"
                password="${target.password}"
                command="mkdir ${deploy.target.dir}"
                failonerror="false"
                trust="true"/>
        <scp todir="${target.username}@${target.host}:~/${deploy.target.dir}" 
                password="${target.password}" trust="yes">
            <fileset dir="${deploy.local.dir}" />
        </scp>
        
        <!--<exec executable="${basedir}/antRunAsync" failonerror="true">
            <env key="ANTRUN_NOHUP" value="false" />
            <env key="ANTRUN_OUTPUT" value="teste.log" />
            <arg value="${basedir}/remote_deploy" />
            <arg value="${target.username}@${target.host}" />
            <arg value="${deploy.target.dir}" />
        </exec>-->

        <!--<sshexec host="${target.host}"
                username="${target.username}"
                password="${target.password}"
                command="cd ${deploy.target.dir}; ant -f deploy_target.xml"/>-->

        <!--<sshexec host="${target.host}"
                username="${target.username}"
                password="${target.password}"
                command="cd ${deploy.target.dir}; ant -f deploy_target.xml"/>-->
                
        <!--<exec executable="${basedir}/antRunAsync" failonerror="true">
            <env key="ANTRUN_NOHUP" value="true" />
            <env key="ANTRUN_OUTPUT" value="teste.log" />
            <arg value="ssh" />
            <arg value="-t" />
            <arg value="${target.username}@${target.host}" />
            <arg value="'sudo ant -f /home/firstuser/${deploy.target.dir}/deploy_target.xml'" />
        </exec>-->
        
        <!--<exec executable="/usr/bin/ssh" failonerror="false">
            <arg value="-t" />
            <arg value="${target.username}@${target.host}" />
            <arg value="'cd ${deploy.target.dir}; ant -f deploy_target.xml'" />
        </exec>-->
        
    </target>
</project>
